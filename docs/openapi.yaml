openapi: 3.0.3
info:
  title: TCGer API
  description: REST API for TCGer - Trading Card Collection Manager
  version: 0.1.0

servers:
  - url: /api
    description: Docker gateway / reverse-proxy path
  - url: /
    description: Direct backend service (no API prefix)
  - url: http://localhost:3001
    description: Local backend example port

security: []

tags:
  - name: Health
    description: Liveness and readiness probes
  - name: Auth
    description: Authentication and initial setup
  - name: Cards
    description: Card search and details
  - name: Collections
    description: Binder and card collection management (requires auth)
  - name: Wishlists
    description: Wishlist management with collection completion tracking (requires auth)
  - name: Users
    description: User profile and preferences (requires auth)
  - name: Settings
    description: Application settings

paths:
  # ─── Health ──────────────────────────────────────────────────────────
  /health:
    get:
      tags: [Health]
      summary: Liveness check
      operationId: getHealth
      responses:
        "200":
          description: Service is alive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  env:
                    type: string
                    example: development

  /health/ready:
    get:
      tags: [Health]
      summary: Readiness check
      operationId: getReadiness
      responses:
        "200":
          description: Service is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ready

  # ─── Auth ────────────────────────────────────────────────────────────
  /auth/signup:
    post:
      tags: [Auth]
      summary: Register a new user
      operationId: signup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupInput"
      responses:
        "201":
          description: User created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          $ref: "#/components/responses/ValidationError"

  /auth/login:
    post:
      tags: [Auth]
      summary: Authenticate user
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginInput"
      responses:
        "200":
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          $ref: "#/components/responses/ValidationError"

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user from token
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current user
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: "#/components/schemas/AuthUser"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout (client-side token removal)
      operationId: logout
      responses:
        "200":
          description: Logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully

  /auth/setup-required:
    get:
      tags: [Auth]
      summary: Check if initial admin setup is needed
      operationId: checkSetupRequired
      responses:
        "200":
          description: Setup status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SetupCheckResponse"

  /auth/setup:
    post:
      tags: [Auth]
      summary: Create the initial admin user
      operationId: setupAdmin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupInput"
      responses:
        "201":
          description: Admin user created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          $ref: "#/components/responses/ValidationError"

  # ─── Cards ───────────────────────────────────────────────────────────
  /cards/search:
    get:
      tags: [Cards]
      summary: Search cards across all TCGs
      operationId: searchCards
      security:
        - bearerAuth: []
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
            minLength: 1
        - name: tcg
          in: query
          required: false
          schema:
            $ref: "#/components/schemas/TcgCode"
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  cards:
                    type: array
                    items:
                      $ref: "#/components/schemas/Card"
                  total:
                    type: integer
        "400":
          $ref: "#/components/responses/ValidationError"

  /cards/{tcg}/{cardId}:
    get:
      tags: [Cards]
      summary: Get a single card by TCG and ID
      operationId: getCard
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/tcg"
        - $ref: "#/components/parameters/cardId"
      responses:
        "200":
          description: Card detail
          content:
            application/json:
              schema:
                type: object
                properties:
                  card:
                    $ref: "#/components/schemas/Card"
        "404":
          $ref: "#/components/responses/NotFound"

  /cards/{tcg}/{cardId}/prints:
    get:
      tags: [Cards]
      summary: Get all prints of a card
      operationId: getCardPrints
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/tcg"
        - $ref: "#/components/parameters/cardId"
      responses:
        "200":
          description: Card prints
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CardPrintsResponse"

  # ─── Collections ─────────────────────────────────────────────────────
  /collections:
    get:
      tags: [Collections]
      summary: List all binders for the authenticated user
      operationId: getBinders
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of binders with cards
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Binder"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      tags: [Collections]
      summary: Create a new binder
      operationId: createBinder
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBinderInput"
      responses:
        "201":
          description: Binder created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Binder"
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /collections/{binderId}:
    get:
      tags: [Collections]
      summary: Get a single binder
      operationId: getBinder
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/binderId"
      responses:
        "200":
          description: Binder detail
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Binder"
        "404":
          $ref: "#/components/responses/NotFound"
    patch:
      tags: [Collections]
      summary: Update a binder
      operationId: updateBinder
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/binderId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateBinderInput"
      responses:
        "200":
          description: Updated binder
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Binder"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      tags: [Collections]
      summary: Delete a binder
      operationId: deleteBinder
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/binderId"
      responses:
        "204":
          description: Binder deleted
        "404":
          $ref: "#/components/responses/NotFound"

  /collections/tags:
    get:
      tags: [Collections]
      summary: List all tags for the authenticated user
      operationId: getTags
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of tags
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CollectionTagResponse"
    post:
      tags: [Collections]
      summary: Create a new tag
      operationId: createTag
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTagInput"
      responses:
        "201":
          description: Tag created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CollectionTagResponse"

  /collections/cards:
    post:
      tags: [Collections]
      summary: Add a card to the library (no binder)
      operationId: addCardToLibrary
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddCardInput"
      responses:
        "201":
          description: Card added to library
          content:
            application/json:
              schema:
                type: object
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /collections/{binderId}/cards:
    post:
      tags: [Collections]
      summary: Add a card to a binder
      operationId: addCardToBinder
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/binderId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddCardInput"
      responses:
        "201":
          description: Card added
          content:
            application/json:
              schema:
                type: object
        "404":
          $ref: "#/components/responses/NotFound"

  /collections/{binderId}/cards/{collectionId}:
    patch:
      tags: [Collections]
      summary: Update a card in a binder
      operationId: updateCollectionCard
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/binderId"
        - $ref: "#/components/parameters/collectionId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateCardInput"
      responses:
        "200":
          description: Updated card
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CollectionCard"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      tags: [Collections]
      summary: Remove a card from a binder
      operationId: removeCardFromBinder
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/binderId"
        - $ref: "#/components/parameters/collectionId"
      responses:
        "204":
          description: Card removed
        "404":
          $ref: "#/components/responses/NotFound"

  # ─── Wishlists ──────────────────────────────────────────────────────
  /wishlists:
    get:
      tags: [Wishlists]
      summary: List all wishlists for the authenticated user
      operationId: getWishlists
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of wishlists with completion data
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/WishlistResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      tags: [Wishlists]
      summary: Create a new wishlist
      operationId: createWishlist
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWishlistInput"
      responses:
        "201":
          description: Wishlist created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistResponse"
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /wishlists/{wishlistId}:
    get:
      tags: [Wishlists]
      summary: Get a single wishlist with all cards and completion status
      operationId: getWishlist
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/wishlistId"
      responses:
        "200":
          description: Wishlist detail with cards and ownership info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    patch:
      tags: [Wishlists]
      summary: Update a wishlist
      operationId: updateWishlist
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/wishlistId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateWishlistInput"
      responses:
        "200":
          description: Updated wishlist
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      tags: [Wishlists]
      summary: Delete a wishlist
      operationId: deleteWishlist
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/wishlistId"
      responses:
        "204":
          description: Wishlist deleted
        "404":
          $ref: "#/components/responses/NotFound"

  /wishlists/{wishlistId}/cards:
    post:
      tags: [Wishlists]
      summary: Add a card to a wishlist
      operationId: addCardToWishlist
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/wishlistId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddWishlistCardInput"
      responses:
        "201":
          description: Card added to wishlist
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistCardResponse"
        "404":
          $ref: "#/components/responses/NotFound"

  /wishlists/{wishlistId}/cards/{wishlistCardId}:
    delete:
      tags: [Wishlists]
      summary: Remove a card from a wishlist
      operationId: removeCardFromWishlist
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/wishlistId"
        - name: wishlistCardId
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Card removed from wishlist
        "404":
          $ref: "#/components/responses/NotFound"

  # ─── Users ───────────────────────────────────────────────────────────
  /users/me:
    get:
      tags: [Users]
      summary: Get current user profile
      operationId: getUserProfile
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "401":
          $ref: "#/components/responses/Unauthorized"
    patch:
      tags: [Users]
      summary: Update user profile
      operationId: updateUserProfile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProfileInput"
      responses:
        "200":
          description: Updated profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUser"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /users/me/preferences:
    get:
      tags: [Users]
      summary: Get user preferences
      operationId: getUserPreferences
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserPreferences"
        "401":
          $ref: "#/components/responses/Unauthorized"
    patch:
      tags: [Users]
      summary: Update user preferences
      operationId: updateUserPreferences
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePreferencesInput"
      responses:
        "200":
          description: Updated preferences
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserPreferences"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /users/me/change-password:
    post:
      tags: [Users]
      summary: Change password
      operationId: changePassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordInput"
      responses:
        "200":
          description: Password changed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ─── Settings ────────────────────────────────────────────────────────
  /settings:
    get:
      tags: [Settings]
      summary: Get application settings
      operationId: getSettings
      responses:
        "200":
          description: App settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AppSettings"
    patch:
      tags: [Settings]
      summary: Update application settings
      operationId: updateSettings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSettingsInput"
      responses:
        "200":
          description: Updated settings
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AppSettings"

# ═══════════════════════════════════════════════════════════════════════
# Components
# ═══════════════════════════════════════════════════════════════════════
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    tcg:
      name: tcg
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/TcgCode"
    cardId:
      name: cardId
      in: path
      required: true
      schema:
        type: string
    binderId:
      name: binderId
      in: path
      required: true
      schema:
        type: string
    collectionId:
      name: collectionId
      in: path
      required: true
      schema:
        type: string
    wishlistId:
      name: wishlistId
      in: path
      required: true
      schema:
        type: string

  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:
    # ─── Enums & Primitives ──────────────────────────────────────────
    TcgCode:
      type: string
      enum: [yugioh, magic, pokemon]

    # ─── Error ───────────────────────────────────────────────────────
    ErrorResponse:
      type: object
      required: [error, message]
      properties:
        error:
          type: string
          example: NOT_FOUND
        message:
          type: string
          example: Resource not found
        details:
          type: object

    # ─── Auth ────────────────────────────────────────────────────────
    SignupInput:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        username:
          type: string

    LoginInput:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 1

    AuthUser:
      type: object
      required: [id, email, isAdmin, showCardNumbers, showPricing, enabledYugioh, enabledMagic, enabledPokemon]
      properties:
        id:
          type: string
        email:
          type: string
        username:
          type: string
          nullable: true
        isAdmin:
          type: boolean
        showCardNumbers:
          type: boolean
        showPricing:
          type: boolean
        enabledYugioh:
          type: boolean
        enabledMagic:
          type: boolean
        enabledPokemon:
          type: boolean

    AuthResponse:
      type: object
      required: [user, token]
      properties:
        user:
          $ref: "#/components/schemas/AuthUser"
        token:
          type: string

    SetupCheckResponse:
      type: object
      required: [setupRequired]
      properties:
        setupRequired:
          type: boolean

    # ─── Cards ───────────────────────────────────────────────────────
    Card:
      type: object
      required: [id, tcg, name]
      properties:
        id:
          type: string
        tcg:
          $ref: "#/components/schemas/TcgCode"
        name:
          type: string
        setCode:
          type: string
        setName:
          type: string
        rarity:
          type: string
        collectorNumber:
          type: string
        releasedAt:
          type: string
        imageUrl:
          type: string
        imageUrlSmall:
          type: string
        setSymbolUrl:
          type: string
          description: URL to the set expansion symbol image
        setLogoUrl:
          type: string
          description: URL to the set logo/branding image (Pokemon and MTG)
        regulationMark:
          type: string
        language:
          type: string
        pokemonPrint:
          $ref: "#/components/schemas/PokemonPrintMetadata"
        attributes:
          type: object
          additionalProperties: true

    PokemonPrintMetadata:
      type: object
      properties:
        tcgdexId:
          type: string
        tcgdexImage:
          type: string
        variants:
          $ref: "#/components/schemas/PokemonVariantFlags"
        finishes:
          type: array
          items:
            type: string
            enum: [normal, reverse, holo, firstEdition]
        category:
          type: string
        regulationMark:
          type: string
        language:
          type: string

    PokemonVariantFlags:
      type: object
      properties:
        normal:
          type: boolean
        reverse:
          type: boolean
        holo:
          type: boolean
        firstEdition:
          type: boolean

    PokemonFunctionalGroup:
      type: object
      required: [functionalKey, name]
      properties:
        functionalKey:
          type: string
        name:
          type: string
        supertype:
          type: string
        subtypes:
          type: array
          items:
            type: string
        hp:
          type: string
        regulationMark:
          type: string
        category:
          type: string
        normalizedRules:
          type: string
          nullable: true
        attacks:
          type: array
          items:
            type: object
            required: [name]
            properties:
              name:
                type: string
              cost:
                type: array
                items:
                  type: string
              text:
                type: string
                nullable: true
              damage:
                type: string
                nullable: true
              convertedEnergyCost:
                type: integer
        abilities:
          type: array
          items:
            type: object
            required: [name]
            properties:
              name:
                type: string
              text:
                type: string
                nullable: true
              type:
                type: string
        rules:
          type: array
          nullable: true
          items:
            type: string

    CardPrintsResponse:
      oneOf:
        - type: object
          required: [mode, prints, total]
          properties:
            mode:
              type: string
              enum: [simple]
            prints:
              type: array
              items:
                $ref: "#/components/schemas/Card"
            total:
              type: integer
        - type: object
          required: [mode, prints, total, functionalGroup]
          properties:
            mode:
              type: string
              enum: [pokemon-functional]
            prints:
              type: array
              items:
                $ref: "#/components/schemas/Card"
            total:
              type: integer
            functionalGroup:
              $ref: "#/components/schemas/PokemonFunctionalGroup"
      discriminator:
        propertyName: mode

    # ─── Collections ─────────────────────────────────────────────────
    CollectionTag:
      type: object
      required: [id, label, colorHex]
      properties:
        id:
          type: string
        label:
          type: string
        colorHex:
          type: string

    CollectionTagResponse:
      allOf:
        - $ref: "#/components/schemas/CollectionTag"
        - type: object
          required: [createdAt, updatedAt]
          properties:
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

    CollectionCardCopy:
      type: object
      required: [id, tags]
      properties:
        id:
          type: string
        condition:
          type: string
        language:
          type: string
        notes:
          type: string
        price:
          type: number
        acquisitionPrice:
          type: number
        serialNumber:
          type: string
        acquiredAt:
          type: string
          format: date-time
        tags:
          type: array
          items:
            $ref: "#/components/schemas/CollectionTag"

    CollectionCard:
      type: object
      required: [id, cardId, name, tcg, quantity, copies]
      properties:
        id:
          type: string
        cardId:
          type: string
        externalId:
          type: string
        name:
          type: string
        tcg:
          type: string
        setCode:
          type: string
        setName:
          type: string
        rarity:
          type: string
        imageUrl:
          type: string
        imageUrlSmall:
          type: string
        quantity:
          type: integer
        condition:
          type: string
        language:
          type: string
        notes:
          type: string
        price:
          type: number
        binderId:
          type: string
        binderName:
          type: string
        binderColorHex:
          type: string
        conditionSummary:
          type: string
        copies:
          type: array
          items:
            $ref: "#/components/schemas/CollectionCardCopy"

    Binder:
      type: object
      required: [id, name, cards, createdAt, updatedAt]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        colorHex:
          type: string
        cards:
          type: array
          items:
            $ref: "#/components/schemas/CollectionCard"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateBinderInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
        colorHex:
          type: string
          pattern: "^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"

    UpdateBinderInput:
      type: object
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
        colorHex:
          type: string
          pattern: "^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"

    CardDataPayload:
      type: object
      required: [name, tcg, externalId]
      properties:
        name:
          type: string
        tcg:
          type: string
        externalId:
          type: string
        setCode:
          type: string
        setName:
          type: string
        rarity:
          type: string
        imageUrl:
          type: string
        imageUrlSmall:
          type: string

    TagPayload:
      type: object
      required: [label]
      properties:
        label:
          type: string
          minLength: 1
        colorHex:
          type: string
          pattern: "^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"

    AddCardInput:
      type: object
      required: [cardId]
      properties:
        cardId:
          type: string
          minLength: 1
        quantity:
          type: integer
          minimum: 1
          default: 1
        condition:
          type: string
        language:
          type: string
        notes:
          type: string
        price:
          type: number
        acquisitionPrice:
          type: number
        serialNumber:
          type: string
        acquiredAt:
          type: string
          format: date-time
        tags:
          type: array
          items:
            type: string
        newTags:
          type: array
          items:
            $ref: "#/components/schemas/TagPayload"
        cardData:
          $ref: "#/components/schemas/CardDataPayload"

    UpdateCardInput:
      type: object
      description: At least one field must be provided
      properties:
        condition:
          type: string
          nullable: true
        language:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
        serialNumber:
          type: string
          nullable: true
        acquiredAt:
          type: string
          format: date-time
          nullable: true
        quantity:
          type: integer
          minimum: 1
        tags:
          type: array
          items:
            type: string
        newTags:
          type: array
          items:
            $ref: "#/components/schemas/TagPayload"
        targetBinderId:
          type: string
          minLength: 1
        cardOverride:
          type: object
          required: [cardId]
          properties:
            cardId:
              type: string
              minLength: 1
            cardData:
              $ref: "#/components/schemas/CardDataPayload"

    CreateTagInput:
      type: object
      required: [label]
      properties:
        label:
          type: string
          minLength: 1
        colorHex:
          type: string
          pattern: "^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"

    # ─── Wishlists ─────────────────────────────────────────────────
    WishlistCardResponse:
      type: object
      required: [id, externalId, tcg, name, owned, ownedQuantity, createdAt]
      properties:
        id:
          type: string
        externalId:
          type: string
        tcg:
          $ref: "#/components/schemas/TcgCode"
        name:
          type: string
        setCode:
          type: string
        setName:
          type: string
        rarity:
          type: string
        imageUrl:
          type: string
        imageUrlSmall:
          type: string
        setSymbolUrl:
          type: string
          description: URL to the set expansion symbol image
        setLogoUrl:
          type: string
          description: URL to the set logo/branding image
        collectorNumber:
          type: string
        notes:
          type: string
        owned:
          type: boolean
          description: Whether this card exists in the user's collection
        ownedQuantity:
          type: integer
          description: Total quantity owned across all binders
        createdAt:
          type: string
          format: date-time

    WishlistResponse:
      type: object
      required: [id, name, cards, totalCards, ownedCards, completionPercent, createdAt, updatedAt]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        colorHex:
          type: string
        cards:
          type: array
          items:
            $ref: "#/components/schemas/WishlistCardResponse"
        totalCards:
          type: integer
          description: Number of unique cards in the wishlist
        ownedCards:
          type: integer
          description: Number of cards that exist in the user's collection
        completionPercent:
          type: integer
          description: Completion percentage (0-100)
          minimum: 0
          maximum: 100
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateWishlistInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
        colorHex:
          type: string
          pattern: "^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"

    UpdateWishlistInput:
      type: object
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
        colorHex:
          type: string
          pattern: "^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"

    AddWishlistCardInput:
      type: object
      required: [externalId, tcg, name]
      properties:
        externalId:
          type: string
          minLength: 1
        tcg:
          type: string
          minLength: 1
        name:
          type: string
          minLength: 1
        setCode:
          type: string
        setName:
          type: string
        rarity:
          type: string
        imageUrl:
          type: string
        imageUrlSmall:
          type: string
        setSymbolUrl:
          type: string
        setLogoUrl:
          type: string
        collectorNumber:
          type: string
        notes:
          type: string

    # ─── Users ───────────────────────────────────────────────────────
    UserProfile:
      type: object
      required: [id, email, isAdmin, showCardNumbers, showPricing, createdAt]
      properties:
        id:
          type: string
        email:
          type: string
        username:
          type: string
          nullable: true
        isAdmin:
          type: boolean
        showCardNumbers:
          type: boolean
        showPricing:
          type: boolean
        createdAt:
          type: string
          format: date-time

    UserPreferences:
      type: object
      required: [showCardNumbers, showPricing, enabledYugioh, enabledMagic, enabledPokemon]
      properties:
        showCardNumbers:
          type: boolean
        showPricing:
          type: boolean
        enabledYugioh:
          type: boolean
        enabledMagic:
          type: boolean
        enabledPokemon:
          type: boolean

    UpdatePreferencesInput:
      type: object
      description: At least one field must be provided
      properties:
        showCardNumbers:
          type: boolean
        showPricing:
          type: boolean
        enabledYugioh:
          type: boolean
        enabledMagic:
          type: boolean
        enabledPokemon:
          type: boolean

    UpdateProfileInput:
      type: object
      description: At least one field must be provided
      properties:
        username:
          type: string
          minLength: 1
          maxLength: 50
        email:
          type: string
          format: email

    ChangePasswordInput:
      type: object
      required: [currentPassword, newPassword]
      properties:
        currentPassword:
          type: string
          minLength: 1
        newPassword:
          type: string
          minLength: 8

    # ─── Settings ────────────────────────────────────────────────────
    AppSettings:
      type: object
      required: [id, publicDashboard, publicCollections, requireAuth, appName, updatedAt]
      properties:
        id:
          type: integer
        publicDashboard:
          type: boolean
        publicCollections:
          type: boolean
        requireAuth:
          type: boolean
        appName:
          type: string
        updatedAt:
          type: string
          format: date-time

    UpdateSettingsInput:
      type: object
      properties:
        publicDashboard:
          type: boolean
        publicCollections:
          type: boolean
        requireAuth:
          type: boolean
        appName:
          type: string
